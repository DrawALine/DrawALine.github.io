var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function a(t){try{c(i.next(t))}catch(e){r(e)}}function s(t){try{c(i["throw"](t))}catch(e){r(e)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}c((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(i){n=[6,i],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},UIComponent=function(t){function e(e){var n=t.call(this)||this;return n.layerType=UILayerType.main,n.addEventListener(eui.UIEvent.COMPLETE,n._init,n),n.skinName=e,n}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype._init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,1];case 1:return t.sent(),UIManager.instance.addView(this),this.onCompleted(),[2]}})})},e}(eui.Component);__reflect(UIComponent.prototype,"UIComponent",["eui.UIComponent","egret.DisplayObject"]);var GameLogic=function(){function t(t){this.mStarterPlayer=new PlayerLogic(PlayerType.starter),this.mLaterPlayer=new PlayerLogic(PlayerType.later),this.mCommondLine=new CommandLineBuilder,this.mCommandDel=new YmFuns,this.mPlayerId=t}return Object.defineProperty(t.prototype,"isNetBattle",{get:function(){return this.mNetBattle},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playerId",{get:function(){return this.mPlayerId},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e){this.mCurRound=1,this.mStarterPlayer.init(t),this.mLaterPlayer.init(e)},t.prototype.addCommmandEvent=function(t,e){this.mCommandDel.add(t,e)},t.prototype.removeCommmandEvent=function(t){this.mCommandDel.remove(t)},Object.defineProperty(t.prototype,"curRound",{get:function(){return this.mCurRound},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFullRound",{get:function(){return this.mCurRound>Constant.RoundCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFinish",{get:function(){return null!=this.getDeadPlayer()||null!=this.getGuessingPlayer()},enumerable:!0,configurable:!0}),t.prototype.getDeadPlayer=function(){return this.mStarterPlayer.isSurvivie?this.mLaterPlayer.isSurvivie?null:this.mLaterPlayer:this.mStarterPlayer},t.prototype.getGuessingPlayer=function(){return this.mStarterPlayer.isGuessing?this.mStarterPlayer:this.mLaterPlayer.isGuessing?this.mLaterPlayer:null},t.prototype.getCurPlayer=function(){return this.mCurRound%2>=1?this.mStarterPlayer:this.mLaterPlayer},t.prototype.getOpponentPlayer=function(){return this.mCurRound%2>=1?this.mLaterPlayer:this.mStarterPlayer},t.prototype.getPlayer=function(t){return this.mStarterPlayer.id==t?this.mStarterPlayer:this.mLaterPlayer.id==t?this.mLaterPlayer:null},t.prototype.getPlayerByType=function(t){return t==PlayerType.starter?this.mStarterPlayer:this.mLaterPlayer},t.prototype.getQPlayer=function(){var t=this.getCurPlayer();return t.lastAction==ActionType.Q1ToRival||t.lastAction==ActionType.Q2ToRival?t:this.getOpponentPlayer()},t.prototype.getAPlayer=function(){var t=this.getCurPlayer();return t.lastAction==ActionType.Q1ToSelf||t.lastAction==ActionType.Q2ToSelf?t:this.getOpponentPlayer()},t}();__reflect(GameLogic.prototype,"GameLogic");var UIBattlePanel=function(t){function e(e){var n=t.call(this,"resource/eui_skins/skin/UIBattleSkin.exml")||this;return n.mGameLogic=e,n}return __extends(e,t),e.prototype.onCompleted=function(){this.mBulletStateArray=[];for(var t=0;t<Constant.BulletRandomRate.length;t++)this.mBulletStateArray[t]=BulletState.unShoot;this.bulletList.itemRenderer=UIBulletItem,this.bulletList.dataProvider=new eui.ArrayCollection(this.mBulletStateArray),this.action_0.Set(ConfigManager.instance.GetText("action0"),this._onClickAction_0,this),this.action_1.Set(ConfigManager.instance.GetText("action1"),this._onClickAction_1,this),this.action_2.Set(ConfigManager.instance.GetText("action2"),this._onClickAction_2,this),this.action_3.Set(ConfigManager.instance.GetText("action3"),this._onClickAction_3,this),this.mActionButtonList=[this.action_0,this.action_1,this.action_2,this.action_3],this.actionStatusText.text="",this.exitBtn.Set(ConfigManager.instance.GetText("returnMainMenu"),this._close,this),this.otherRoundGroup.visible=!1,this.mGameLogic.addCommmandEvent(this._dealCommandLine,this),this._refresh()},e.prototype.onRemove=function(){this.mGameLogic.removeCommmandEvent(this._dealCommandLine)},e.prototype.start=function(){var t={id:"aaaaa",name:"先攻玩家",ready:!0},e={id:"bbbbb",name:"后攻玩家",ready:!0};this.mGameLogic.init(t,e)},e.prototype._refresh=function(){var t=Tools.formatStr(ConfigManager.instance.GetText("round"),this.mGameLogic.curRound);this.bg.setText(t);var e=this.mGameLogic.getCurPlayer();this.actionPlayerText.text=e.name;for(var n=0,i=this.mActionButtonList;n<i.length;n++){var o=i[n];o.touchEnabled=!1,o.alpha=.5}for(var r=0,a=e.getCurActionOption();r<a.length;r++){var o=a[r];this.mActionButtonList[o].touchEnabled=!0,this.mActionButtonList[o].alpha=1}for(var s in this.mBulletStateArray){var c=parseInt(s);c>=this.mGameLogic.curBulletPosition?this.mBulletStateArray[s]=BulletState.unShoot:null!=this.mGameLogic.getDeadPlayer()&&c==this.mGameLogic.curBulletPosition-1?this.mBulletStateArray[s]=BulletState.hit:this.mBulletStateArray[s]=BulletState.shot}this.bulletList.dataProvider=new eui.ArrayCollection(this.mBulletStateArray)},e.prototype._dealCommandLine=function(t,e){e?(new UIMessagePanel(t,YmFun.c(this).fun(this._dealLogic),this.mGameLogic),this.mGameLogic.removeCommmandEvent(this._dealCommandLine)):this._refresh()},e.prototype._dealLogic=function(){return this.mGameLogic.addCommmandEvent(this._dealCommandLine,this),this._refresh(),this.mGameLogic.isFinish?void new UIFinishPanel(this.mGameLogic,YmFun.c(this).fun(this._close)):void 0},e.prototype._onClickAction_0=function(){this.mGameLogic.selectAction(ActionType.Q1ToRival)},e.prototype._onClickAction_1=function(){this.mGameLogic.selectAction(ActionType.Q1ToSelf)},e.prototype._onClickAction_2=function(){this.mGameLogic.selectAction(ActionType.Q2ToRival)},e.prototype._onClickAction_3=function(){this.mGameLogic.selectAction(ActionType.Q2ToSelf)},e.prototype._close=function(){UIManager.instance.removeUI(this)},e}(UIComponent);__reflect(UIBattlePanel.prototype,"UIBattlePanel");var Main=function(t){function e(){var e=t.call(this)||this;return e.mScene=new BaseScene,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addChild(UIManager.instance),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.mScene.init()];case 1:return e.sent(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function o(t){e.call(i,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(i))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(i,generateJSON.paths[t])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var CalcEval=function(){function t(){}return t.complexEval=function(t){if(null==t)return 0;"string"!=typeof t&&(t+=""),t=t.replace(/\s/g,"");for(var e=/\(([^\(\\)]*?)\)/g.exec(t);null!=e;){var n=e[1],i="";""!=n&&(i=String(this.simpleEval(n))),t=t.replace(e[0],i),e=/\(([^\(\\)]*?)\)/g.exec(t)}return this.simpleEval(t)},t.simpleEval=function(t){if(null==t||""==t)return 0;"string"!=typeof t&&(t+="");for(var e=[],n=[],i="0",o=t.split(""),r=!1,a=0;a<o.length;a++)if("+"==o[a]||"-"==o[a]||"*"==o[a]||"/"==o[a]){var s=Number(i);if(r){var c=e.pop(),u=n.pop();s=this.simpleTwoEval(u,c,s)}e.push(s),n.push(o[a]),i="0",r=!1,("*"==o[a]||"/"==o[a])&&(r=!0)}else if(i+=o[a],a==o.length-1){var s=Number(i);if(r){var l=e.pop(),u=n.pop(),m=this.simpleTwoEval(u,l,s);s=m}e.push(s)}for(e=this.reverseArray(e),n=this.reverseArray(n);e.length>1;){var h=e.pop(),p=e.pop(),u=n.pop();e.push(this.simpleTwoEval(u,h,p))}return e[0]},t.simpleTwoEval=function(t,e,n){return"+"==t?e+n:"-"==t?e-n:"*"==t?e*n:"/"==t?e/n:0},t.reverseArray=function(t){for(var e=[],n=t.length,i=0;n>i;i++)e.push(t.pop());return e},t}();__reflect(CalcEval.prototype,"CalcEval");var ConfigManager=function(){function t(){this.initBaseConfig()}return Object.defineProperty(t,"instance",{get:function(){return this.sInstance||(this.sInstance=new t),this.sInstance},enumerable:!0,configurable:!0}),t.prototype.initBaseConfig=function(){this.mLanguage={};for(var t=RES.getRes("language_json"),e=0,n=t;e<n.length;e++){var i=n[e];this.mLanguage[i.key]=i.value}this.mRuleText=RES.getRes("rule_txt")},t.prototype.GetText=function(t){return null!=this.mLanguage[t]?this.mLanguage[t]:""},t.prototype.GetRuleText=function(){return this.mRuleText},t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(ConfigManager.prototype,"ConfigManager");var Tools;!function(t){function e(t,e){if(e)for(var n in t.items)t.items[n].props={loop:!0};t.play()}function n(t,e){for(var n=t.parent;n instanceof e==0&&(n=n.parent,null!=n););return n}function i(t){null!=t&&egret.Tween.get(t).to({scaleX:1.1,scaleY:1.1},100,egret.Ease.quadOut).to({scaleX:1,scaleY:1},100,egret.Ease.quadOut)}t.playAnimation=e,t.findContainer=n,t.scaleButtonAni=i}(Tools||(Tools={}));var NotifyCenter=function(){function t(){this.mNotifDict={}}return Object.defineProperty(t,"instForever",{get:function(){return this.sForeverInstance||(this.sForeverInstance=new t),this.sForeverInstance},enumerable:!0,configurable:!0}),Object.defineProperty(t,"instMain",{get:function(){return this.sMainInstance||(this.sMainInstance=new t),this.sMainInstance},enumerable:!0,configurable:!0}),t.sendNotification=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];Tools.getValidArgs(arguments,1);t.instMain.sendNotification.apply(t.instMain,arguments),t.instForever.sendNotification.apply(t.instForever,arguments)},t.prototype.clearAllNotifications=function(){this.mNotifDict={}},t.prototype.registerNotification=function(t,e,n){var i=YmFun.c(n).fun(e);this.insertNotification(t,i,-1)},t.prototype.addNotification=function(t,e){this.insertNotification(t,e,-1)},t.prototype.insertNotification=function(t,e,n){void 0===n&&(n=0);var i;return t in this.mNotifDict?i=this.mNotifDict[t]:(i=[],this.mNotifDict[t]=i),0>n||n>=i.length?void i.push(e):void i.splice(n,0,e)},t.prototype.removeNotification=function(t,e){t in this.mNotifDict&&(null==e?this.mNotifDict[t]=[]:this.mNotifDict[t]=Tools.removeValueAndResize(this.mNotifDict[t],function(t){return t["function"]==e}))},t.prototype.sendNotification=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t in this.mNotifDict)for(var i=Tools.getValidArgs(arguments,1),o=this.mNotifDict[t],r=0,a=o;r<a.length;r++){var s=a[r];s.executeArray(i)}},t.prototype.hasNotification=function(t,e){if(t in this.mNotifDict)for(var n=this.mNotifDict[t],i=0,o=n;i<o.length;i++){var r=o[i];if(r["function"]==e)return!0}return!1},t}();__reflect(NotifyCenter.prototype,"NotifyCenter");var Tools;!function(t){function e(t){alert("call from native "+t)}function n(){return(new Date).getTime()}function i(t,e,n){var i;t in n?i=n[t]:(i=[],n[t]=i),i.push(e)}function o(t,e){for(var n in e)if(t.hasOwnProperty(n)){var i=t[n],o=e[n],r=typeof i,a=typeof e[n];"object"!=a&&"number"===a?("string"===r&&""==i&&(i="0"),o-Math.floor(o)>0?e[n]=parseFloat(i):e[n]=parseInt(i)):e[n]=t[n]}}function r(e,n){for(var i in e)if(e.hasOwnProperty(i)){var o=e[i],r=n[i],a=typeof o,s=typeof n[i];if("object"===a){if(null==o){n[i]=o;continue}n[i]=o.constructor===Array?[]:{},t.deepcopy(o,n[i])}else"number"===s?("string"===a&&""==o&&(o="0"),r-Math.floor(r)>0?n[i]=parseFloat(o):n[i]=parseInt(o)):n[i]=e[i]}}function a(t,e,n){for(var i in t)t.hasOwnProperty(i)&&typeof t[i]===n&&(e[i]=t[i])}function s(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=0;return t=t.replace(/%s/g,function(t,n){return e[i++]})}function c(t,e){return t=t.replace(/#\w+#/g,function(t,n){var i=t.substr(1,t.length-2);return i in e?e[i]:""})}function u(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e=e+"\n"+n+":"+t[n]);return e}function l(t){var e=[];for(var n in t)e.push(parseInt(n));return e}function m(t,e){if(t>e){var n=e;e=t,t=n}var i=1/(e-t+1),o=Math.random(),r=Math.floor(o/i);return t+r}function h(t){if(0==t.length)return null;var e=t.length-1,n=m(0,e);return t[n]}function p(t,e,n){void 0===n&&(n=2);var i=t/e||0;return i*=100,0==i?0:Number(i.toFixed(2))}function f(t,e){void 0===e&&(e=0);for(var n=[],i=e;i<t.length;i++)n[i-e]=t[i];return n}function y(e,n){var i,o=t.formatObj2Str(e,n);return i=CalcEval.complexEval(o)}function g(t,e){for(var n=0,i=0;i<t.length;i++)e(t[i])?n++:t[i-n]=t[i];for(var i=0;n>i;i++)t.pop();return t}function d(t,e){if(void 0===e&&(e=1),0==e)return t.toString();var n=t/e;return(~~(100*n)).toString()+"%"}function v(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];t||console.error(e,n)}t.sendToJS=e,t.getUnixTime=n,t.addToListInMap=i,t.copyByNewValue=o,t.deepcopy=r,t.copyWithType=a,t.formatStr=s,t.formatObj2Str=c,t.forDic2Str=u,t.getNumKeys=l,t.randomInt=m,t.randomArr=h,t.getWinPer=p,t.getValidArgs=f,t.getCalculation=y,t.removeValueAndResize=g,t.converPercenStr=d,t.assert=v}(Tools||(Tools={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?i(o):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var UILayerType;!function(t){t[t.scene=0]="scene",t[t.main=1]="main",t[t.popup=2]="popup"}(UILayerType||(UILayerType={}));var UIManager=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){var t=this;return t.m_instance||(t.m_instance=new e),t.m_instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.touchThrough=!0,this.m_sceneLayer=this.buildNewLayer(),this.m_mainLayer=this.buildNewLayer(),this.m_popUplayer=this.buildNewLayer(),this.addChild(this.m_sceneLayer),this.addChild(this.m_mainLayer),this.addChild(this.m_popUplayer)},e.prototype.removeUI=function(t){t.parent.removeChild(t),t.onRemove()},e.prototype.RemoveUIUpper=function(t,e){var n=t.parent,i=n.getChildIndex(t),o=n.numChildren;e||i++;for(var r=o-1;r>=i;r--)n.removeChildAt(r)},e.prototype.removeLayer=function(t){for(var e=this._getLayer(t),n=e.numChildren-1;n>=0;n--){var i=e.getChildAt(n);i.onRemove(),i.parent.removeChild(i)}},e.prototype.removeAll=function(){this.removeLayer(UILayerType.main),this.removeLayer(UILayerType.scene),this.removeLayer(UILayerType.popup),this.m_sceneLayer.removeChildren(),this.m_mainLayer.removeChildren(),this.m_popUplayer.removeChildren(),this.m_sceneLayer=this.buildNewLayer(),this.m_mainLayer=this.buildNewLayer(),this.m_popUplayer=this.buildNewLayer(),this.addChild(this.m_sceneLayer),this.addChild(this.m_mainLayer),this.addChild(this.m_popUplayer)},e.prototype.buildNewLayer=function(){var t=new eui.UILayer;return t.touchThrough=!0,t},e.prototype.addView=function(t){this._getLayer(t.layerType).addChild(t)},e.prototype._getLayer=function(t){switch(t){case UILayerType.scene:return this.m_sceneLayer;case UILayerType.main:return this.m_mainLayer;case UILayerType.popup:return this.m_popUplayer}return this.m_mainLayer},e}(eui.UILayer);__reflect(UIManager.prototype,"UIManager");var YmFun=function(){function t(t){this.obj=t}return t.c=function(e){return new t(e)},t.prototype.fun=function(t){return this["function"]=t,this},t.prototype.execute=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!=this["function"]&&this["function"].apply(this.obj,t)},t.prototype.executeArray=function(t){null!=this["function"]&&this["function"].apply(this.obj,t)},t.prototype.equal=function(t){return this["function"]==t["function"]&&this.obj==t.obj},t}();__reflect(YmFun.prototype,"YmFun");var YmFuns=function(){function t(){this.funs=[]}return t.prototype.execute=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,i=this.funs;n<i.length;n++){var o=i[n];o.executeArray(t)}},t.prototype.add=function(t,e){var n=YmFun.c(e).fun(t);this.funs.push(n)},t.prototype.remove=function(t){Tools.removeValueAndResize(this.funs,function(e){return e["function"]==t})},t.prototype.clear=function(){this.funs=[]},t}();__reflect(YmFuns.prototype,"YmFuns");var CommandLineBuilder=function(){function t(){}return t.prototype.init=function(){this.mCmdList=[]},t.prototype.addCmd=function(t,e,n,i){this.mCmdList.push(new CommandLineItem(t,e,n,i))},t.prototype.createIter=function(){return new CommandLineIter(this.mCmdList)},t}();__reflect(CommandLineBuilder.prototype,"CommandLineBuilder");var CommandLineIter=function(){function t(t){this.mCmdList=[].concat(t),this.mIndex=0}return t.prototype.reStart=function(){this.mIndex=0},t.prototype.getNextCmd=function(){if(this.hasNext){var t=this.mCmdList[this.mIndex];return this.mIndex++,t}return null},Object.defineProperty(t.prototype,"hasNext",{get:function(){return this.mIndex<this.mCmdList.length},enumerable:!0,configurable:!0}),t}();__reflect(CommandLineIter.prototype,"CommandLineIter");var CommandLineItem=function(){function t(t,e,n,i){this.mCmd=t,this.mArg=e,this.mCast=n,this.mTarget=i}return Object.defineProperty(t.prototype,"cmd",{get:function(){return this.mCmd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"arg",{get:function(){return this.mArg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cast",{get:function(){return this.mCast},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){return this.mTarget},enumerable:!0,configurable:!0}),t}();__reflect(CommandLineItem.prototype,"CommandLineItem");var Constant=function(){function t(){}return t.BulletRandomRate=[100,150,200,200,200,150],t.NormalRandomRate=[100,100,100,100,100,100],t.ShootCountAction=[1,0,2,0],t.RoundCount=8,t.ShootCountGuessWrong=1,t.ShootCountGuessTrue=4,t.CmdCheckBullet="checkBullet",t.CmdResetBullet="resetBullet",t.CmdShoot="shoot",t.CmdSelectAction="selectAction",t.URL="ws://fenghua.51vip.biz",t.EventEnterFrame="enterFrame",t.NetEnterRoom=101,t.NetLeaveRoom=102,t.NetReady=103,t.NetActionSelect=1001,t.NetGuess=1002,t.NetFinishRound=1010,t.NoticSocketClose="noticSocketClose",t}();__reflect(Constant.prototype,"Constant");var ActionType;!function(t){t[t.None=-1]="None",t[t.Q1ToRival=0]="Q1ToRival",t[t.Q1ToSelf=1]="Q1ToSelf",t[t.Q2ToRival=2]="Q2ToRival",t[t.Q2ToSelf=3]="Q2ToSelf"}(ActionType||(ActionType={}));var BulletState;!function(t){t[t.unShoot=0]="unShoot",t[t.shot=1]="shot",t[t.hit=2]="hit"}(BulletState||(BulletState={}));var PlayerType;!function(t){t[t.starter=0]="starter",t[t.later=1]="later"}(PlayerType||(PlayerType={}));var GameStataus;!function(t){t[t.startRound=0]="startRound",t[t.awaitQA=1]="awaitQA",t[t.finish=2]="finish"}(GameStataus||(GameStataus={}));var RoomStatus;!function(t){t[t.waiting=0]="waiting",t[t.readying=1]="readying",t[t.playing=2]="playing",t[t.end=3]="end"}(RoomStatus||(RoomStatus={}));var BaseScene=function(){function t(){}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t="resource/",[4,RES.loadConfig("default.res.json",t)];case 1:return e.sent(),[4,RES.loadGroup("preload")];case 2:return e.sent(),[4,this.loadTheme()];case 3:return e.sent(),UIManager.instance.addEventListener(egret.TimerEvent.ENTER_FRAME,this.onEnterFrame,this),this.enter(),[2]}})})},t.prototype.loadTheme=function(){return new Promise(function(t,e){var n=new eui.Theme("resource/default.thm.json",UIManager.instance.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},UIManager.instance.stage)})},t.prototype.enter=function(){new UIMainMenuPanel},t.prototype.onEnterFrame=function(t){NotifyCenter.instForever.sendNotification(Constant.EventEnterFrame)},t}();__reflect(BaseScene.prototype,"BaseScene");var GunLogic=function(){function t(){}return Object.defineProperty(t.prototype,"bulletCount",{get:function(){return this.mBulletCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curPosition",{get:function(){return this.mCurPosition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitPosition",{get:function(){return this.mHitPosition},enumerable:!0,configurable:!0}),t.prototype.init=function(t){var e=t?Constant.NormalRandomRate:Constant.BulletRandomRate;this.mBulletCount=e.length,this.mCurPosition=0;for(var n=0,i=0,o=e;i<o.length;i++){var r=o[i];n+=r}var a=Tools.randomInt(0,n-1);console.log(a),n=0;for(var s in e)if(n+=e[s],n>a){this.mHitPosition=parseInt(s);break}},t.prototype.isCauseHurt=function(){return this.mCurPosition>this.mHitPosition},t.prototype.shoot=function(t){this.isCauseHurt()||(this.mCurPosition+=t,this.mCurPosition>this.mHitPosition&&(this.mCurPosition=this.mHitPosition+1))},t}();__reflect(GunLogic.prototype,"GunLogic");var NetGameLogic=function(t){function e(e){var n=t.call(this,e)||this;return n.mNetBattle=!0,n}return __extends(e,t),e.prototype.init=function(e,n){t.prototype.init.call(this,e,n),this.mGameStatus=GameStataus.startRound,this.mCurBulletPosition=0},e.prototype.again=function(){var t=new NetMessage.Req;t.cmd=Constant.NetReady,WebSocketManager.Instance.send(t)},Object.defineProperty(e.prototype,"curBulletPosition",{get:function(){return this.mCurBulletPosition},enumerable:!0,configurable:!0}),e.prototype.selectAction=function(t){if(this.mGameStatus==GameStataus.startRound&&this.mPlayerId==this.getCurPlayer().id){var e=new NetMessage.Req;e.cmd=Constant.NetActionSelect,e.actionSelect=new NetMessage.ReqActionSelect,e.actionSelect.action=t,WebSocketManager.Instance.send(e)}else new UITip("不是你的当前回合")},e.prototype.guess=function(t){if(this.mGameStatus==GameStataus.awaitQA)if(this.getAPlayer().id==this.mPlayerId){var e=new NetMessage.Req;e.cmd=Constant.NetGuess,e.guess=new NetMessage.ReqGuess,e.guess.isGuessing=t,WebSocketManager.Instance.send(e)}else new UITip("你不是回答的玩家，不能点决定猜测结果");else new UITip("当前阶段不是问答阶段")},e.prototype.nextRound=function(){if(this.mGameStatus==GameStataus.awaitQA)if(this.getCurPlayer().id==this.mPlayerId){var t=new NetMessage.Req;t.cmd=Constant.NetFinishRound,WebSocketManager.Instance.send(t)}else new UITip("你不是当前行动玩家，不能自己结束回合");else new UITip("当前阶段不是问答阶段")},e.prototype.DealMsg=function(t){if(!(t.ret>0)){this.mCommondLine.init();var e=this.getCurPlayer(),n=(this.getOpponentPlayer(),this.mCurBulletPosition);if(null!=t.gameState){for(var i=0,o=t.gameState.players;i<o.length;i++){var r=o[i],a=this.getPlayer(r.playerId);a.setLastAction(r.lastAction),a.setSurviveState(!r.isHit),a.setGuessing(r.isGuessing)}this.mGameStatus=t.gameState.gameStatus,this.mCurBulletPosition=t.gameState.curBulletPosition,this.mCurRound=t.gameState.round}if(t.cmd==Constant.NetFinishRound)return void this.mCommandDel.execute(null,!1);if(t.cmd==Constant.NetGuess)this._shoot(n,this.mCurBulletPosition,e,null!=this.getGuessingPlayer()?this.getAPlayer():this.getQPlayer()),this.mCommandDel.execute(this.mCommondLine.createIter(),!0);else if(t.cmd==Constant.NetActionSelect){switch(this.mCommondLine.addCmd(Constant.CmdSelectAction,t.actionSelect.action,e.playerType,e.playerType),t.actionSelect.action){case ActionType.Q1ToRival:this._shoot(n,this.mCurBulletPosition,e,e);break;case ActionType.Q1ToSelf:break;case ActionType.Q2ToRival:this._resetBullet(e),this._shoot(n,this.mCurBulletPosition,e,e);break;case ActionType.Q2ToSelf:this.mRealBulletPoition=t.actionSelect.exrData,this._checkBullet(e)}this.mCommandDel.execute(this.mCommondLine.createIter(),!0)}}},e.prototype._shoot=function(t,e,n,i){if(e-t>0){var o={hit:!i.isSurvivie,startPosition:t,endPosition:e};this.mCommondLine.addCmd(Constant.CmdShoot,o,n.playerType,i.playerType)}},e.prototype._checkBullet=function(t){this.mCommondLine.addCmd(Constant.CmdCheckBullet,this.mRealBulletPoition,t.playerType,t.playerType)},e.prototype._resetBullet=function(t){this.mCommondLine.addCmd(Constant.CmdResetBullet,null,t.playerType,t.playerType)},e}(GameLogic);__reflect(NetGameLogic.prototype,"NetGameLogic");var PlayerLogic=function(){function t(t){this.mPlayerType=t,this.mLastActionType=ActionType.None,this.mIsSurvive=!0,this.mIsGuessing=!1}return Object.defineProperty(t.prototype,"lastAction",{get:function(){return this.mLastActionType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playerType",{get:function(){return this.mPlayerType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSurvivie",{get:function(){return this.mIsSurvive},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGuessing",{get:function(){return this.mIsGuessing},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.mId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.mName},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this.mLastActionType=ActionType.None,this.mIsSurvive=!0,this.mIsGuessing=!1,this.mId=t.id,this.mName=t.name},t.prototype.setLastAction=function(t){this.mLastActionType=t},t.prototype.setSurviveState=function(t){this.mIsSurvive=t},t.prototype.setGuessing=function(t){this.mIsGuessing=t},t.prototype.getCurActionOption=function(){switch(this.mLastActionType){case ActionType.None:case ActionType.Q1ToRival:case ActionType.Q1ToSelf:case ActionType.Q2ToRival:return[ActionType.Q1ToRival,ActionType.Q1ToSelf,ActionType.Q2ToRival,ActionType.Q2ToSelf];case ActionType.Q2ToSelf:return[ActionType.Q1ToRival,ActionType.Q2ToRival]}},t.prototype.checkSelectedOption=function(t){var e=this.getCurActionOption();return e.some(function(e,n){return e==t})},t}();__reflect(PlayerLogic.prototype,"PlayerLogic");var SingleGameLogic=function(t){function e(){var e=t.call(this,null)||this;return e.mGun=new GunLogic,e.mNetBattle=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"curBulletPosition",{get:function(){return this.mGun.curPosition},enumerable:!0,configurable:!0}),e.prototype.init=function(e,n){t.prototype.init.call(this,e,n),this.mGun.init(!1)},e.prototype.again=function(){var t={id:this.mStarterPlayer.id,name:this.mStarterPlayer.name,ready:!0},e={id:this.mLaterPlayer.id,name:this.mLaterPlayer.name,ready:!0};this.init(t,e),this.mCommandDel.execute(null,!1)},e.prototype.selectAction=function(t){if(!this.isFullRound&&!this.isFinish){var e=this.getCurPlayer();if(e.checkSelectedOption(t)){switch(this.mCommondLine.init(),this.mCommondLine.addCmd(Constant.CmdSelectAction,t,e.playerType,e.playerType),t){case ActionType.Q1ToRival:this._shoot(Constant.ShootCountAction[t],e,e);break;case ActionType.Q1ToSelf:break;case ActionType.Q2ToRival:this._resetBullet(e),this._shoot(Constant.ShootCountAction[t],e,e);break;case ActionType.Q2ToSelf:this._checkBullet(e)}e.setLastAction(t);var n=this.mCommondLine.createIter();this.mCommandDel.execute(n,!0)}}},e.prototype.nextRound=function(){this.mCurRound++,this.mCurRound>Constant.RoundCount&&(this.mCurRound=1,this.mGun.init(!1));var t=this.mCommondLine.createIter();this.mCommandDel.execute(t,!1)},e.prototype.guess=function(t){if(!this.isFinish){var e=this.getAPlayer(),n=this.getQPlayer();this.mCommondLine.init(),e.setGuessing(t);var i=t?Constant.ShootCountGuessTrue:Constant.ShootCountGuessWrong;this._shoot(i,e,t?e:n),this.mCommandDel.execute(this.mCommondLine.createIter(),!0)}},e.prototype._shoot=function(t,e,n){if(t>0){var i=this.mGun.curPosition;this.mGun.shoot(t);var o=this.mGun.curPosition;n.setSurviveState(!this.mGun.isCauseHurt());var r={hit:this.mGun.isCauseHurt(),startPosition:i,endPosition:o};this.mCommondLine.addCmd(Constant.CmdShoot,r,e.playerType,n.playerType)}},e.prototype._resetBullet=function(t){this.mGun.init(!0),this.mCommondLine.addCmd(Constant.CmdResetBullet,null,t.playerType,t.playerType)},e.prototype._checkBullet=function(t){this.mCommondLine.addCmd(Constant.CmdCheckBullet,this.mGun.hitPosition,t.playerType,t.playerType)},e}(GameLogic);__reflect(SingleGameLogic.prototype,"SingleGameLogic");var WebSocketManager=function(){function t(){this.mMessageReceiver=new YmFuns}return Object.defineProperty(t,"Instance",{get:function(){return null==this.mInstance&&(this.mInstance=new t),this.mInstance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isConnecting",{get:function(){return null!=this.mWebSocket&&this.mWebSocket.readyState==this.mWebSocket.OPEN},enumerable:!0,configurable:!0}),t.prototype.registerReceive=function(t,e){this.mMessageReceiver.add(t,e)},t.prototype.removeReceive=function(t){this.mMessageReceiver.remove(t)
},t.prototype.open=function(t,e){this.mWebSocket=new WebSocket(Constant.URL),this.mWebSocket.binaryType="arraybuffer",this.mStartConnectTime=Tools.getUnixTime(),this.mOnlineDel=t,this.mOfflineDel=e;var n=this;this.mWebSocket.onopen=function(){n.onOpend()},this.mWebSocket.onclose=function(){n.onClose()},this.mWebSocket.onmessage=function(t){n.onMessage(t)},this.mWebSocket.onerror=function(t){n.onError(t)}},t.prototype.close=function(){NotifyCenter.instForever.registerNotification(Constant.EventEnterFrame,this.checkClose,this)},t.prototype.checkClose=function(){this.mWebSocket.bufferedAmount<=0&&(this.mWebSocket.close(),NotifyCenter.instForever.removeNotification(Constant.EventEnterFrame,this.checkClose))},t.prototype.onOpend=function(){null!=this.mOnlineDel&&this.mOnlineDel.execute()},t.prototype.onClose=function(){null!=this.mOfflineDel&&this.mOfflineDel.execute(),NotifyCenter.instForever.sendNotification(Constant.NoticSocketClose)},t.prototype.onMessage=function(t){var e=new Uint8Array(t.data),n=NetMessage.Res.decode(e);return n.ret>0?void new UITip(ConfigManager.instance.GetText("net_"+n.ret)):(console.log("收到消息 "+n.cmd),void this.mMessageReceiver.execute(n))},t.prototype.onError=function(t){this.close()},t.prototype.send=function(t){this.isConnecting&&(console.log("发送消息 "+t.cmd),this.mWebSocket.send(NetMessage.Req.encode(t).finish()))},t}();__reflect(WebSocketManager.prototype,"WebSocketManager");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var UIBgItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setText=function(t){this.title.text=t},e}(eui.Component);__reflect(UIBgItem.prototype,"UIBgItem");var UIBulletItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/skin/BulletSkin.exml",e}return __extends(e,t),e.prototype.dataChanged=function(){switch(this.data){case BulletState.unShoot:return void(this.currentState="unShoot");case BulletState.shot:return void(this.currentState="shot");case BulletState.hit:return void(this.currentState="hit")}this.currentState="unShoot"},e}(eui.ItemRenderer);__reflect(UIBulletItem.prototype,"UIBulletItem");var UIButtonItem=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e._onClick,e),e}return __extends(e,t),e.prototype.Set=function(t,e,n){this.title.text=t,this.mFun=e,this.mTarget=n,this.x+=this.width/2+this.anchorOffsetX,this.y+=this.height/2+this.anchorOffsetY,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},e.prototype._onClick=function(){egret.Tween.get(this).to({scaleX:.9,scaleY:.9},50).to({scaleX:1,scaleY:1},50).call(this.mFun,this.mTarget)},e}(eui.Component);__reflect(UIButtonItem.prototype,"UIButtonItem");var UIFinishPanel=function(t){function e(e,n){var i=t.call(this,"resource/eui_skins/skin/UIFinishSkin.exml")||this;return i.mConfirmFun=n,i.mGameLogic=e,i}return __extends(e,t),e.prototype.onCompleted=function(){this.confirmBtn.Set(ConfigManager.instance.GetText("returnMainMenu"),this._onClickConfirm,this),this.againBtn.Set(ConfigManager.instance.GetText("againBattle"),this._onClickAgain,this);var t="",e=this.mGameLogic.getGuessingPlayer();if(null!=e){var n=e.name;t+=Tools.formatStr(ConfigManager.instance.GetText("guessingReslute"),n)}t+="\n";var i=this.mGameLogic.getDeadPlayer();if(null!=i){var o=i.name;t+=Tools.formatStr(ConfigManager.instance.GetText("hitReslute"),o)}this.finishText.text=t},e.prototype.onRemove=function(){},e.prototype._onClickConfirm=function(){this.mConfirmFun.execute(),UIManager.instance.removeUI(this)},e.prototype._onClickAgain=function(){UIManager.instance.removeUI(this),this.mGameLogic.again()},e}(UIComponent);__reflect(UIFinishPanel.prototype,"UIFinishPanel");var UIInterducePanel=function(t){function e(){return t.call(this,"resource/eui_skins/skin/UIInterduceSkin.exml")||this}return __extends(e,t),e.prototype.onCompleted=function(){this.bg.setText(ConfigManager.instance.GetText("interduceTitle")),this.interduceText.text=ConfigManager.instance.GetRuleText(),this.interduceText.textColor=0,this.interduceText.height=this.interduceText.percentHeight,this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.verticalScrollBar.visible=!1,this.confirmBtn.Set(ConfigManager.instance.GetText("alreadyRead"),this._onClickConfirm,this)},e.prototype.onRemove=function(){},e.prototype._onClickConfirm=function(){UIManager.instance.removeUI(this)},e}(UIComponent);__reflect(UIInterducePanel.prototype,"UIInterducePanel");var UIMainMenuPanel=function(t){function e(){var e=t.call(this,"resource/eui_skins/skin/UIMainMenuSkin.exml")||this;return e.layerType=UILayerType.scene,e}return __extends(e,t),e.prototype.onCompleted=function(){this.bg.setText(ConfigManager.instance.GetText("gameName")),this.enterBtn.Set(ConfigManager.instance.GetText("battleTitle"),this._onClickEnter,this),this.interduceBtn.Set(ConfigManager.instance.GetText("interduceTitle"),this._onClickInterduce,this),this.netBattleBtn.Set("网Q",this._onClickNetBattle,this),NotifyCenter.instForever.addNotification(Constant.NoticSocketClose,YmFun.c(this).fun(this._listerClose))},e.prototype.onRemove=function(){},e.prototype._onClickEnter=function(){var t=new SingleGameLogic;new UIBattlePanel(t).start()},e.prototype._onClickNetBattle=function(){new UIRoomCreatePanel},e.prototype._onClickInterduce=function(){new UIInterducePanel},e.prototype._listerClose=function(){UIManager.instance.removeLayer(UILayerType.main),new UITip(ConfigManager.instance.GetText("net_close"))},e}(UIComponent);__reflect(UIMainMenuPanel.prototype,"UIMainMenuPanel");var UIMessagePanel=function(t){function e(e,n,i){var o=t.call(this,"resource/eui_skins/skin/UIMessageSkin.exml")||this;return o.mCmdIter=e,o.mConfirmFun=n,o.mGameLogic=i,o}return __extends(e,t),e.prototype.onCompleted=function(){this.bg.setText(ConfigManager.instance.GetText("messageTitile")),this.confirmBtn.Set(ConfigManager.instance.GetText("returnBattle"),this._onClickConfirm,this),this.guessingWroing.Set(ConfigManager.instance.GetText("guessingWrong"),this._onClickGuessingWrong,this),this.guessingTrue.Set(ConfigManager.instance.GetText("guessingTrue"),this._onClickGuessingTrue,this),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.scroller.scrollPolicyV=eui.ScrollPolicy.AUTO,this.messageText.text="",this.messageText.textColor=0,this.mGameLogic.addCommmandEvent(this._refresh,this),this._refresh(this.mCmdIter,!0)},e.prototype.onRemove=function(){this.mGameLogic.removeCommmandEvent(this._refresh)},e.prototype._refresh=function(t,e){if(this.mGameLogic.isNetBattle&&(this.confirmBtn.enabled=this.mGameLogic.getCurPlayer().id==this.mGameLogic.playerId||this.mGameLogic.isFinish,this.confirmBtn.alpha=this.confirmBtn.enabled?1:.6,this.guessingTrue.enabled=this.mGameLogic.getAPlayer().id==this.mGameLogic.playerId,this.guessingTrue.alpha=this.guessingTrue.enabled?1:.6,this.guessingWroing.enabled=this.mGameLogic.getAPlayer().id==this.mGameLogic.playerId,this.guessingWroing.alpha=this.guessingWroing.enabled?1:.6),!e)return void this._closeActio();for(var n=null,i="";t.hasNext;){var o=t.getNextCmd();if(o.cmd==Constant.CmdSelectAction)n=o;else if(o.cmd==Constant.CmdCheckBullet)i+=Tools.formatStr(ConfigManager.instance.GetText("cmdCheckBullet"),o.arg+1)+"\n";else if(o.cmd==Constant.CmdResetBullet)i+=ConfigManager.instance.GetText("cmdResetBullet")+"\n";else if(o.cmd==Constant.CmdShoot)for(var r=o.arg,a=this.mGameLogic.getPlayerByType(o.target).name,s=r.startPosition;s<r.endPosition;s++)i+=s==r.endPosition-1&&r.hit?Tools.formatStr(ConfigManager.instance.GetText("cmdShootHit"),s+1,a)+"\n":Tools.formatStr(ConfigManager.instance.GetText("cmdShootUnhit"),s+1,a)+"\n"}if(null!=n){this.mActionPlayer=n.cast,this.mSelectType=n.arg;var c=this.mGameLogic.getPlayerByType(n.cast).name,u="action"+n.arg,l="QAText"+n.arg,m=Tools.formatStr(ConfigManager.instance.GetText("cmdSelect"),c,ConfigManager.instance.GetText(u))+"\n",h=this.mGameLogic.isFinish?ConfigManager.instance.GetText("gameFinish"):Tools.formatStr(ConfigManager.instance.GetText(l),this.mGameLogic.getQPlayer().name);h+="\n",i=m+i+h}this.messageText.text+=i,this._refreshComponent()},e.prototype._refreshComponent=function(){this.messageText.height=this.messageText.percentHeight,null!=this.scroller.verticalScrollBar&&(this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.verticalScrollBar.visible=!1)},e.prototype._onClickConfirm=function(){this.mGameLogic.isFinish?this._closeActio():this.mGameLogic.nextRound()},e.prototype._onClickGuessingWrong=function(){this.mGameLogic.guess(!1)},e.prototype._onClickGuessingTrue=function(){this.mGameLogic.guess(!0)},e.prototype._closeActio=function(){this.mConfirmFun.execute(),UIManager.instance.removeUI(this)},e}(UIComponent);__reflect(UIMessagePanel.prototype,"UIMessagePanel");var UINetBattlePanel=function(t){function e(e,n){var i=t.call(this,e)||this;return i.mInitRes=n,i}return __extends(e,t),e.prototype.onCompleted=function(){t.prototype.onCompleted.call(this),WebSocketManager.Instance.registerReceive(this._dealMessage,this),this._dealMessage(this.mInitRes)},e.prototype.onRemove=function(){t.prototype.onRemove.call(this),WebSocketManager.Instance.removeReceive(this._dealMessage)},e.prototype._refresh=function(){t.prototype._refresh.call(this),this._refreshStatusView()},e.prototype._close=function(){WebSocketManager.Instance.close(),t.prototype._close.call(this)},e.prototype.start=function(){null!=this.mPlayerDic[PlayerType.starter]&&null!=this.mPlayerDic[PlayerType.later]&&this.mGameLogic.init(this.mPlayerDic[PlayerType.starter],this.mPlayerDic[PlayerType.later])},e.prototype._dealMessage=function(t){var e=this.mRoomStatus;if(null!=t.roomState&&(this.mRoomStatus=t.roomState.RoomStatus),this.mRoomStatus!=RoomStatus.playing&&e!=this.mRoomStatus)this.mPlayerDic={},t.castId==t.playerId&&(UIManager.instance.RemoveUIUpper(this,!1),this._refreshStatusView());else if(this.mRoomStatus==RoomStatus.playing&&e!=this.mRoomStatus){this.mPlayerDic={};for(var n=function(e){var n={id:e.playerId,name:e.name,ready:e.ready},o=-1;t.gameState.players.forEach(function(t,e){t.playerId==n.id&&(o=e)});var r=t.gameState.players[o];i.mPlayerDic[r.playerType]=n},i=this,o=0,r=t.roomState.playerMessages;o<r.length;o++){var a=r[o];n(a)}this.start(),this._refresh()}else null!=t.gameState&&this.mGameLogic.DealMsg(t)},e.prototype._refreshStatusView=function(){this.mRoomStatus!=RoomStatus.playing?(this.otherRoundGroup.visible=!0,this.actionStatusText.text=ConfigManager.instance.GetText("waitingRoom"),this.exitBtn.visible=!0):(this.otherRoundGroup.visible=!(this.mGameLogic.getCurPlayer().id==this.mGameLogic.playerId),this.actionStatusText.text=ConfigManager.instance.GetText("waitingOpponentAction"),this.exitBtn.visible=!1)},e}(UIBattlePanel);__reflect(UINetBattlePanel.prototype,"UINetBattlePanel");var UIRoomCreatePanel=function(t){function e(){var e=t.call(this,"resource/eui_skins/skin/RoomCreateSkin.exml")||this;return WebSocketManager.Instance.isConnecting||WebSocketManager.Instance.open(YmFun.c(e).fun(e._connectSuccess),YmFun.c(e).fun(e._connectFail)),e}return __extends(e,t),e.prototype.onCompleted=function(){this.confirmBtn.Set(ConfigManager.instance.GetText("confirm"),this._onClickConfirm,this),this.cancleBtn.Set(ConfigManager.instance.GetText("cancle"),this._onClickCancle,this),WebSocketManager.Instance.registerReceive(this._dealNetMessage,this)},e.prototype.onRemove=function(){WebSocketManager.Instance.removeReceive(this._dealNetMessage)},e.prototype._connectSuccess=function(){console.log("连接成功")},e.prototype._connectFail=function(){console.log("连接失败")},e.prototype._onClickConfirm=function(){if(WebSocketManager.Instance.isConnecting&&null!=this.roomInput.text&&null!=this.passwordInput.text&&null!=this.nameInput.text){var t=new NetMessage.Req;t.cmd=Constant.NetEnterRoom,t.enterRoom=new NetMessage.ReqEnterRoom,t.enterRoom.name=this.nameInput.text,t.enterRoom.password=this.passwordInput.text,t.enterRoom.roomId=parseInt(this.roomInput.text),WebSocketManager.Instance.send(t),console.log("发送进入房间")}},e.prototype._dealNetMessage=function(t){0==t.ret&&t.cmd==Constant.NetEnterRoom&&(new UINetBattlePanel(new NetGameLogic(t.playerId),t),UIManager.instance.removeUI(this))},e.prototype._onClickCancle=function(){WebSocketManager.Instance.close(),UIManager.instance.removeUI(this)},e}(UIComponent);__reflect(UIRoomCreatePanel.prototype,"UIRoomCreatePanel");var UITip=function(t){function e(e){var n=t.call(this,"resource/eui_skins/skin/TipSkin.exml")||this;return n.layerType=UILayerType.popup,n.mString=e,n}return __extends(e,t),e.prototype.onCompleted=function(){this.msg.text=this.mString,this.ani.addEventListener(egret.Event.COMPLETE,this._close,this),this.ani.play(0)},e.prototype.onRemove=function(){},e.prototype._close=function(){this.ani.removeEventListener(egret.Event.COMPLETE,this._close,this),UIManager.instance.removeUI(this)},e}(UIComponent);__reflect(UITip.prototype,"UITip");